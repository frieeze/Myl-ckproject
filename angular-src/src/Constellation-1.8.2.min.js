/*
 *	 Constellation Platform 1.8
 *	 Web site: http://www.myConstellation.io
 *	 Copyright (C) 2014-2017 - Sebastien Warin <http://sebastien.warin.fr>	   	
 *	 All Rights Reserved.  
 *	
 *	 NOTICE:  All information contained herein is, and remains the property of Sebastien Warin.
 *	 The intellectual and technical concepts contained herein are proprietary to Sébastien Warin.
 *	 Dissemination of this information or reproduction of this material is strictly forbidden
 *   unless prior written permission is obtained from Sébastien Warin.	 
*/
!function(e,t,n){"use strict";function r(t,n){return function(){n.apply(t,e.makeArray(arguments))}}function a(t,n){var a,o,s,u,c;for(a in t)if(t.hasOwnProperty(a)){if(o=t[a],!o.hubName)continue;c=n?o.on:o.off;for(s in o.client)if(o.client.hasOwnProperty(s)){if(u=o.client[s],!e.isFunction(u))continue;c.call(o,s,r(o,u))}}}if("function"!=typeof e.signalR)throw new Error("SignalR: SignalR is not loaded. Please ensure jquery.signalR-x.js is referenced before ~/signalr/js.");var o=e.signalR,s={};e.hubConnection.prototype.createHubProxies=function(t){var r={};return this.starting(function(){a(r,!0),this._registerSubscribedHubs()}).disconnected(function(){a(r,!1)}),"consumerHub"==t?(r.Consumer=this.createHubProxy("consumerHub"),r.Consumer.client={onReceiveMessage:function(e){return r.Consumer.on("ReceiveMessage",e)},registerMessageCallback:function(e,t){return r.Consumer.client.onReceiveMessage(function(n){t&&e==n.Key&&t(n)})},onUpdateStateObject:function(e){return r.Consumer.on("UpdateStateObject",e)},registerStateObjectLink:function(e,t,n,a,o){var s=r.Consumer.client.onUpdateStateObject(function(r){!o||r.SentinelName!=e&&"*"!=e||r.PackageName!=t&&"*"!=t||r.Name!=n&&"*"!=n||r.Type!=a&&"*"!=a||o(r)});return r.Consumer.server.requestSubscribeStateObjects(e,t,n,a),s}},r.Consumer.server={requestStateObjects:function(t,n,a,o){return r.Consumer.invoke.apply(r.Consumer,e.merge(["RequestStateObjects"],e.makeArray(arguments)))},sendMessage:function(t,n,a){var o=e.makeArray(arguments);if(o.length<3)o.push("{}");else if(o.length>3){var s=o.slice(2);o=o.slice(0,2),o.push(s)}return r.Consumer.invoke.apply(r.Consumer,e.merge(["SendMessage"],o))},sendMessageWithSaga:function(t,a,o,s){var u=e.makeArray(arguments),c=t;if("function"==typeof c?(c=t,u=u.slice(1)):"function"==typeof u[u.length-1]&&(c=u[u.length-1],u=u.slice(0,u.length-1),a=u[0],o=u[1]),"undefined"==typeof a.SagaId&&(a.SagaId=(new Date).getTime()+Math.floor(1e3*Math.random())),c==n||"function"!=typeof c)throw"Callback not set !";return u=u.slice(2),1==u.length&&(u=u[0]),r.Consumer.client.onReceiveMessage(function(e){c&&e.Scope.SagaId==a.SagaId&&c(e)}),r.Consumer.server.sendMessage(a,o,u)},subscribeMessages:function(t){return r.Consumer.invoke.apply(r.Consumer,e.merge(["SubscribeMessages"],e.makeArray(arguments)))},subscribeStateObjects:function(t,n,a,o){return r.Consumer.invoke.apply(r.Consumer,e.merge(["SubscribeStateObjects"],e.makeArray(arguments)))},unSubscribeMessages:function(t){return r.Consumer.invoke.apply(r.Consumer,e.merge(["UnSubscribeMessages"],e.makeArray(arguments)))},unSubscribeStateObjects:function(t,n,a,o){return r.Consumer.invoke.apply(r.Consumer,e.merge(["UnSubscribeStateObjects"],e.makeArray(arguments)))},requestSubscribeStateObjects:function(e,t,n,a){return r.Consumer.server.requestStateObjects(e,t,n,a),r.Consumer.server.subscribeStateObjects(e,t,n,a)}}):"controlHub"==t?(r.Controller=this.createHubProxy("controlHub"),r.Controller.client={onReceiveLogMessage:function(e){return s.PackagesLog=!0,r.Controller.on("ReceiveLog",e)},onUpdateSentinel:function(e){return s.Sentinels=!0,r.Controller.on("UpdateSentinel",e)},onUpdateSentinelsList:function(e){return r.Controller.on("UpdateSentinelsList",e)},onReportPackageState:function(e){return s.PackagesState=!0,r.Controller.on("ReportPackageState",e)},onReportPackageUsage:function(e){return s.PackagesUsage=!0,r.Controller.on("ReportPackageUsage",e)},onUpdatePackageList:function(e){return r.Controller.on("UpdatePackageList",e)},onUpdatePackageDescriptor:function(e){return r.Controller.on("UpdatePackageDescriptor",e)}},r.Controller.server={addToControlGroup:function(t){return r.Controller.invoke.apply(r.Controller,e.merge(["AddToControlGroup"],e.makeArray(arguments)))},purgeStateObjects:function(t,n,a,o){return r.Controller.invoke.apply(r.Controller,e.merge(["PurgeStateObjects"],e.makeArray(arguments)))},reloadServerConfiguration:function(t){return r.Controller.invoke.apply(r.Controller,e.merge(["ReloadServerConfiguration"],e.makeArray(arguments)))},reload:function(t,n){return r.Controller.invoke.apply(r.Controller,e.merge(["Reload"],e.makeArray(arguments)))},removeToControlGroup:function(t){return r.Controller.invoke.apply(r.Controller,e.merge(["RemoveToControlGroup"],e.makeArray(arguments)))},requestPackageDescriptor:function(t){return r.Controller.invoke.apply(r.Controller,e.merge(["RequestPackageDescriptor"],e.makeArray(arguments)))},requestPackagesList:function(t){return r.Controller.invoke.apply(r.Controller,e.merge(["RequestPackagesList"],e.makeArray(arguments)))},requestSentinelsList:function(){return r.Controller.invoke.apply(r.Controller,e.merge(["RequestSentinelsList"],e.makeArray(arguments)))},requestSentinelUpdates:function(){return r.Controller.invoke.apply(r.Controller,e.merge(["RequestSentinelUpdates"],e.makeArray(arguments)))},restart:function(t,n){return r.Controller.invoke.apply(r.Controller,e.merge(["Restart"],e.makeArray(arguments)))},start:function(t,n){return r.Controller.invoke.apply(r.Controller,e.merge(["Start"],e.makeArray(arguments)))},stop:function(t,n){return r.Controller.invoke.apply(r.Controller,e.merge(["Stop"],e.makeArray(arguments)))},updatePackageSettings:function(t,n){return r.Controller.invoke.apply(r.Controller,e.merge(["UpdatePackageSettings"],e.makeArray(arguments)))}}):"constellationHub"==t&&(r.Package=this.createHubProxy("constellationHub"),r.Package.client={onPackageControlAction:function(e){return r.Package.on("PackageControlAction",e)},onReceiveLastStateObjects:function(e){return r.Package.on("ReceiveLastStateObjects",e)},onUpdateSettings:function(e){return r.Package.on("UpdateSettings",e)},onReceiveMessage:function(e){return r.Package.on("ReceiveMessage",e)},registerMessageCallback:function(e,t){return r.Package.client.onReceiveMessage(function(n){t&&e==n.Key&&t(n)})},onUpdateStateObject:function(e){return r.Package.on("UpdateStateObject",e)},registerStateObjectLink:function(e,t,n,a,o){var s=r.Package.client.onUpdateStateObject(function(r){!o||r.SentinelName!=e&&"*"!=e||r.PackageName!=t&&"*"!=t||r.Name!=n&&"*"!=n||r.Type!=a&&"*"!=a||o(r)});return r.Package.server.requestSubscribeStateObjects(e,t,n,a),s}},r.Package.server={declarePackageDescriptor:function(t){return r.Package.invoke.apply(r.Package,e.merge(["DeclarePackageDescriptor"],e.makeArray(arguments)))},purgeStateObjects:function(t,n){return r.Package.invoke.apply(r.Package,e.merge(["PurgeStateObjects"],e.makeArray(arguments)))},pushStateObject:function(t,a,o,s,u){var c=e.makeArray(arguments);if(c.length<2)throw"Invalid arguments";o=s=u=n;for(var i=2;i<c.length;i++)"string"!=typeof o&&"string"==typeof c[i]&&(o=c[i]),"object"!=typeof s&&"object"==typeof c[i]&&(s=c[i]),"number"!=typeof u&&"number"==typeof c[i]&&(u=c[i]);return c=[t,a,o==n?"":o,s==n?{}:s,u==n?0:u],r.Package.invoke.apply(r.Package,e.merge(["PushStateObject"],c))},requestSettings:function(){return r.Package.invoke.apply(r.Package,e.merge(["RequestSettings"],e.makeArray(arguments)))},requestStateObjects:function(t,n,a,o){return r.Package.invoke.apply(r.Package,e.merge(["RequestStateObjects"],e.makeArray(arguments)))},sendMessage:function(t,n,a){var o=e.makeArray(arguments);if(o.length<3)o.push("{}");else if(o.length>3){var s=o.slice(2);o=o.slice(0,2),o.push(s)}return r.Package.invoke.apply(r.Package,e.merge(["SendMessage"],o))},sendMessageWithSaga:function(t,a,o,s){var u=e.makeArray(arguments),c=t;if("function"==typeof c?(c=t,u=u.slice(1)):"function"==typeof u[u.length-1]&&(c=u[u.length-1],u=u.slice(0,u.length-1),a=u[0],o=u[1]),"undefined"==typeof a.SagaId&&(a.SagaId=(new Date).getTime()+Math.floor(1e3*Math.random())),c==n||"function"!=typeof c)throw"Callback not set !";return u=u.slice(2),1==u.length&&(u=u[0]),r.Package.client.onReceiveMessage(function(e){c&&e.Scope.SagaId==a.SagaId&&c(e)}),r.Package.server.sendMessage(a,o,u)},subscribeMessages:function(t){return r.Package.invoke.apply(r.Package,e.merge(["SubscribeMessages"],e.makeArray(arguments)))},subscribeStateObjects:function(t,n,a,o){return r.Package.invoke.apply(r.Package,e.merge(["SubscribeStateObjects"],e.makeArray(arguments)))},unSubscribeMessages:function(t){return r.Package.invoke.apply(r.Package,e.merge(["UnSubscribeMessages"],e.makeArray(arguments)))},unSubscribeStateObjects:function(t,n,a,o){return r.Package.invoke.apply(r.Package,e.merge(["UnSubscribeStateObjects"],e.makeArray(arguments)))},requestSubscribeStateObjects:function(e,t,n,a){return r.Package.server.requestStateObjects(e,t,n,a),r.Package.server.subscribeStateObjects(e,t,n,a)},writeLog:function(t,n){var a=e.makeArray(arguments);return 2!=a.length&&a.push("Info"),r.Package.invoke.apply(r.Package,e.merge(["WriteLog"],a))}}),r},o.createConstellationConsumer=function(t,n,r){return o.consumerHub=e.hubConnection(t,{useDefaultPath:!0,qs:{SentinelName:"Consumer",PackageName:r,AccessKey:n}}),e.extend(o,o.consumerHub.createHubProxies("consumerHub")),o.Consumer},o.createConstellationPackage=function(t,n,r,a,s){var u={SentinelName:n,PackageName:r,AccessKey:a,ConstellationClientVersion:"1.8.2",ConstellationClientType:"js"};return"undefined"!=typeof s&&(u.PackageVersion=s),o.constellationHub=e.hubConnection(t,{useDefaultPath:!0,qs:u}),e.extend(o,o.constellationHub.createHubProxies("constellationHub")),o.Package},o.createConstellationController=function(t,n,r){return o.controlHub=e.hubConnection(t,{useDefaultPath:!0,qs:{SentinelName:"Controller",PackageName:r,AccessKey:n}}),o.controlHub.stateChanged(function(t){if(t.newState===e.signalR.connectionState.connected)for(var n in s)1==s[n]&&o.Controller.server.addToControlGroup(n)}),e.extend(o,o.controlHub.createHubProxies("controlHub")),o.Controller}}(window.jQuery,window);